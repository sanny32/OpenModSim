Name:           @PACKAGE_NAME@
Version:        1.9.0
Release:        1%{?dist}
Summary:        An Open Source Modbus Slave (Server) Utility
Group:          Applications/Utility
License:        MIT
Source0:        SOURCES/omodsim

%description
An Open Source Modbus Slave (Server) Utility

%global _build_id_links none

%prep

%build


%install
%{__mkdir_p} %{buildroot}/opt
%{__cp} -r %{_sourcedir}/omodsim/opt/* %{buildroot}/opt
%{__mkdir_p} %{buildroot}/usr
%{__cp} -r %{_sourcedir}/omodsim/usr/* %{buildroot}/usr

%post
if [ -f /etc/udev/rules.d/99-omodsim.rules ]; then
    rm -f /etc/udev/rules.d/99-omodsim.rules
fi
if [ ! -f /etc/udev/rules.d/99-omodscan.rules ]; then
    printf  "KERNEL==\"ttyS[0-9]*\", GROUP=\"dialout\", MODE=\"0666\"\n"  >> /etc/udev/rules.d/99-omodsim.rules
    printf  "KERNEL==\"ttyUSB[0-9]*\", GROUP=\"dialout\", MODE=\"0666\"\n"  >> /etc/udev/rules.d/99-omodsim.rules
fi
udevadm trigger

xdg-desktop-menu forceupdate || true
ln -sf /opt/OpenModSim/omodsim.sh /usr/bin/omodsim

%postun
if [ -f /etc/udev/rules.d/99-omodsim.rules ]; then
    rm -f /etc/udev/rules.d/99-omodsim.rules
    udevadm trigger
fi

xdg-desktop-menu forceupdate || true
rm -f /usr/bin/omodsim

%files
/opt/OpenModSim
/usr/share/applications/omodsim.desktop
/usr/share/icons/hicolor/128x128/apps/omodsim.png
/usr/share/icons/hicolor/64x64/apps/omodsim.png
/usr/share/icons/hicolor/32x32/apps/omodsim.png
/usr/share/icons/hicolor/16x16/apps/omodsim.png
%caps(cap_net_bind_service=+ep) /opt/OpenModSim/bin/omodsim
